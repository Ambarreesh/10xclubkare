<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EDU HACK '26 | Console</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Rubik+Glitch&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  :root {
    --st-red: #ff0033;
    --st-green: #00e676;
    --st-blue: #00ccff;
    --st-orange: #ffab00;
    --bg-dark: #050505;
    --glass-surface: rgba(20, 20, 20, 0.85);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text-primary: #e0e0e0;
    --text-secondary: #86868b;
    --font-main: 'JetBrains Mono', monospace;
    --font-title: 'Rubik Glitch', cursive;
  }

  * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

  body {
    margin: 0; font-family: var(--font-main); background-color: var(--bg-dark);
    color: var(--text-primary); min-height: 100vh; overflow-x: hidden;
    background: radial-gradient(circle at 50% -20%, #1a0505 0%, #000 80%);
  }

  body::before {
    content: " "; display: block; position: fixed; top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
    background-size: 100% 4px; z-index: 100; pointer-events: none;
  }

  .app-container {
    max-width: 1200px; margin: 0 auto; padding: 20px; position: relative; z-index: 10;
    display: none; opacity: 0; transition: opacity 1s ease; padding-bottom: 120px;
  }
  .app-container.visible { display: block; opacity: 1; }

  .login-screen {
    position: fixed; inset: 0; z-index: 20; display: flex; flex-direction: column;
    align-items: center; justify-content: center; background: #000; transition: 0.8s ease;
  }
  .login-screen.hidden { transform: translateY(-100%); opacity: 0; pointer-events: none; }

  .glitch-logo {
    font-family: var(--font-title); font-size: 5rem; color: #fff;
    text-shadow: 4px 4px 0px var(--st-red); margin-bottom: 20px;
    animation: glitch 2.5s infinite alternate-reverse; text-align: center; line-height: 1;
  }
  @keyframes glitch {
    0% { text-shadow: 2px 2px 0px var(--st-red); }
    20% { text-shadow: -2px -2px 0px var(--st-blue); }
    40% { text-shadow: 2px 2px 0px var(--st-red); }
  }

  header { border-bottom: 1px solid var(--glass-border); margin-bottom: 30px; padding-bottom: 20px; }
  
  .system-ticker {
    font-size: 0.75rem; color: var(--st-green); background: rgba(0, 230, 118, 0.05);
    padding: 8px; border: 1px solid rgba(0, 230, 118, 0.2); margin-bottom: 20px;
    display: flex; justify-content: space-between;
  }

  .user-badge {
    display: flex; align-items: center; gap: 15px;
    background: rgba(255,255,255,0.03); padding: 10px 20px; border-radius: 4px;
    border-left: 3px solid var(--st-red);
  }
  .user-avatar { width: 40px; height: 40px; background: #333; background-size: cover; border: 1px solid #fff; border-radius: 50%; }

  .tabs { display: flex; gap: 2px; margin-bottom: 30px; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 6px; }
  .tab-btn {
    flex: 1; background: transparent; border: none; color: var(--text-secondary);
    font-family: var(--font-main); font-size: 0.9rem; font-weight: 700;
    padding: 16px; cursor: pointer; transition: 0.3s;
  }
  .tab-btn.active { color: #000; background: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.3); }

  .glass-card {
    background: var(--glass-surface); backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border); padding: 30px; margin-bottom: 24px;
    position: relative;
  }
  .glass-card::before { content:''; position: absolute; top:0; left:0; width: 4px; height: 100%; background: var(--st-red); }

  input {
    background: #111; border: 1px solid #333; color: var(--st-green);
    padding: 12px 18px; font-family: var(--font-main); width: 100%; margin-bottom: 10px;
  }
  .btn {
    background: var(--st-red); color: #fff; border: none; padding: 12px 24px;
    font-weight: 700; cursor: pointer; width: 100%; font-family: var(--font-main);
    clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
    text-decoration: none; display: inline-block; text-align: center;
  }
  .btn:hover { background: #ff3355; color: #fff; }
  .btn:disabled { background: #333; color: #888; cursor: not-allowed; }

  /* MENTOR BTN */
  .mentor-btn {
    position: fixed; bottom: 30px; right: 30px; background: var(--st-orange); color: #000;
    width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 20px rgba(255, 171, 0, 0.4); cursor: pointer; z-index: 999; border: none;
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 171, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 171, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 171, 0, 0); } }

  .timer-display {
    font-family: var(--font-title); font-size: 5rem; color: #fff;
    text-shadow: 0 0 20px rgba(255,0,51,0.6); margin: 20px 0;
  }

  .problem-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px; max-height: 600px; overflow-y: auto; padding-right: 10px;
  }
  .problem-card {
    background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); padding: 15px;
    border-radius: 4px; position: relative; transition: 0.3s;
  }
  .problem-card.full { opacity: 0.5; border-color: var(--st-red); }
  .problem-card.active { border-color: var(--st-blue); }
  .occupancy-badge { 
    position: absolute; top: 10px; right: 10px; font-size: 0.7rem; 
    padding: 2px 8px; border-radius: 10px; background: #333;
  }

  .hidden-section { display: none; }
  .show-section { display: block; animation: fadeIn 0.4s ease-out; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  
  @media(max-width: 768px){ 
    .glitch-logo { font-size: 3rem; } 
    .timer-display { font-size: 3rem; }
  }
</style>
</head>
<body>

<button class="mentor-btn" onclick="callMentor()" title="Call Mentor for Help">
    <span class="material-icons">support_agent</span>
</button>

<div class="login-screen" id="loginScreen">
  <div class="glitch-logo">EDU HACK<br>Console</div>
  <button class="btn" style="width:auto; min-width:250px; background:#fff; color:#000;" id="loginBtn">
    AUTHENTICATE IDENTITY
  </button>
</div>

<div class="app-container" id="appContainer">
  
  <div class="system-ticker">
    <span>SYSTEM: ONLINE</span>
    <span>PHASE 2: HACKATHON LIVE</span>
    <span>CAPACITY: 2 TEAMS PER STATEMENT</span>
    <span>NET: SECURE</span>
  </div>

  <header>
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
      <div class="logos">
        <h1 style="margin:0; font-size:1.8rem; letter-spacing:-1px;">EDUHACK<span style="color:var(--st-red)"> PLAYGROUND</span></h1>
        <span style="font-size:0.8rem; color:var(--text-secondary);">10X CLUB KARE</span>
      </div>
      <div class="user-badge">
        <div class="user-avatar" id="userAvatar"></div>
        <div>
          <div id="userName" style="font-weight:700;">UNKNOWN</div>
          <div style="font-size:0.75rem; color:var(--text-secondary); margin-top:2px;">
            TEAM: <span id="teamNameDisplay" style="color:var(--st-green); font-weight:bold;">CONNECTING...</span>
          </div>
        </div>
        <button class="btn-logout" onclick="logout()" style="background:transparent; border:1px solid var(--st-red); color:var(--st-red); padding:4px 8px; cursor:pointer; font-size:0.7rem; margin-left:10px;">LOGOUT</button>
      </div>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-btn active" onclick="switchTab('hackathon')">Hackathon Console</button>
    <button class="tab-btn" onclick="switchTab('problems')">Problem Statements</button>
    <button class="tab-btn" onclick="switchTab('timeline')">Mission Log</button>
  </nav>

  <div id="hackathon" class="show-section">
    <div style="text-align:center; margin-bottom:40px;">
      <div id="timerLabel" style="font-size:1rem; color:var(--st-red); letter-spacing:4px;">HACKATHON COMMENCES IN</div>
      <div class="timer-display" id="timer">00:00:00:00</div>
      <div id="timerTarget" style="color:var(--text-secondary);">TARGET: JAN 30, 2026 @ 17:00</div>
    </div>

    <div class="glass-card">
      <h2 style="color:var(--st-green);">PROJECT PROTOCOL</h2>
      <div style="margin-bottom:20px; display: grid; grid-template-columns: 1fr 2fr auto; gap: 10px;">
          <input type="number" id="projectTopic" placeholder="Statement ID (1-50)...">
          <input type="text" id="projectTitle" placeholder="Your Project Title...">
          <button class="btn" id="freezeBtn">LOCK PROJECT</button>
      </div>
      <p style="font-size: 0.75rem; color: var(--text-secondary);">*Once locked, project details cannot be modified without mentor intervention.</p>
    </div>

    <div class="glass-card">
      <h3>SUBMISSIONS</h3>
      <div style="margin-bottom:20px;">
          <label style="font-size:0.8rem; color:#888;">ROUND 1: PLANNING PPT (Due 8:15 PM)</label>
          <div style="display:flex; gap:10px;">
              <input type="text" id="round1Link" placeholder="PPT Link...">
              <button class="btn" id="btnRound1" onclick="submitRound1()" style="width:auto;">SEND</button>
          </div>
      </div>
      <div>
          <label style="font-size:0.8rem; color:#888;">FINAL ROUND: GITHUB & PPT (Due 3:30 PM)</label>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
              <input type="text" id="finalGithub" placeholder="GitHub Repo...">
              <input type="text" id="finalPPT" placeholder="Final PPT...">
          </div>
          <button class="btn" id="btnFinalRound" onclick="submitFinalRound()">SUBMIT FINAL PROJECT</button>
      </div>
    </div>
  </div>

  <div id="problems" class="hidden-section">
    <div class="glass-card">
        <h2 style="color:var(--st-blue);">AVAILABLE CHALLENGES</h2>
        <div class="problem-grid" id="problemList">
            </div>
    </div>
  </div>

  <div id="timeline" class="hidden-section">
      <div class="glass-card">
          <h2 style="color:var(--st-red);">MISSION LOG</h2>
          <ul style="list-style:none; padding:0; line-height:1.8; font-size: 0.9rem;">
              <li style="color: var(--text-secondary); opacity: 0.6;">JAN 05-23: Angular Bootcamp Phase [COMPLETE]</li>
              <li style="color: var(--st-green);">JAN 30 5:00 PM: HACKATHON LAUNCH</li>
              <li>5:00PM - 6:00PM : Event Launch</li>
              <li>6:00PM - 6:30PM : Problem Statement Distribution</li>
              <li>6:30PM - 7:00PM : Project Planning</li>
              <li>7:00PM - 8:15PM : Dinner Break</li>
              <li style="color: var(--st-red);">8:15PM - 9:00PM : ROUND 1 SUBMISSION</li>
              <li>11:00PM - 3:00AM : Phase 1 Work</li>
              <li style="color: var(--st-blue);">JAN 31 10:00 AM : Phase 2 Work</li>
              <li style="color: var(--st-red);">3:30PM - 4:00PM : FINAL SUBMISSION</li>
              <li>4:00PM - 5:00PM : Judging & Closing</li>
              <li style="color: var(--st-green);">5:00 PM : Winners Announcement</li>
          </ul>
      </div>
  </div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, doc, updateDoc, serverTimestamp, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBzEwEDcTDs2Y-NUAGZkhQJsFRg6MZxoYE",
    authDomain: "eduhack-432fd.firebaseapp.com",
    projectId: "eduhack-432fd",
    storageBucket: "eduhack-432fd.firebasestorage.app",
    messagingSenderId: "160252785408",
    appId: "1:160252785408:web:6a22e465982e3e510979e5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const EVENT_ID = "edu-hack-2025";
  const DATE_START = new Date("Jan 30, 2026 17:00:00").getTime(); 
  const DATE_END = new Date("Jan 31, 2026 17:00:00").getTime(); 

  let currentTeamId = null;
  let currentUser = null;
  let allProblemStats = {};

  const problems = [
    "Predictive Attendance Risk Analyzer", "Smart Academic Alert Notification Engine", "Automated Transcript Request Workflow",
    "Unified Campus Portal SSO Prototype", "Intelligent Exam Seating Allocation", "Attendance Anomaly Detection System",
    "Faculty Load Distribution Dashboard", "Personalized Elective Recommendation Engine", "Virtual SIS Helpdesk Chatbot",
    "KAFKA Complaint Trend Analytics", "Hostel Maintenance Priority Assignment", "Hostel Occupancy Prediction Simulator",
    "Smart Grievance Escalation Workflow", "Mobile-Friendly Complaint Tracking", "Multilingual Portal Accessibility Layer",
    "Hostel Utility Consumption Analytics", "Smart Campus Bus Route Optimizer", "Real-Time Transport Tracking Simulator",
    "Campus Emergency Broadcast System", "Exam Timetable Clash Detection Tool", "Smart Lab Resource Booking Platform",
    "Peer Mentoring Matchmaking Engine", "Digital Academic Certificate Verification", "Student Feedback Sentiment Analysis",
    "Automated Leave Approval Engine", "Smart Canteen Crowd Prediction", "Lab Utilization Optimization System",
    "Unified University Events Calendar", "Student Skill Gap Identification Engine", "LMS Engagement Analytics Dashboard",
    "Scholarship Eligibility Filtering Engine", "Intelligent Notification Priority Controller", "Centralized Campus Grievance Console",
    "Document Digitization & OCR Tool", "Dynamic University FAQ Generator", "Campus Occupancy Visualization Heatmap",
    "Night Transport Safety Monitoring", "Academic Performance Forecasting Tool", "Alumni Mentorship Matching Platform",
    "Interactive Portal Guidance Assistant", "Hostel Food Quality Analytics Platform", "Smart Hostel Energy Optimization",
    "Campus Data Privacy Risk Scanner", "Degree Progress Audit Automation Tool", "System Downtime Notification Simulator",
    "Third-Party Tool Integration Gateway", "Student Certification Tracking Platform", "Counseling Appointment Queue Manager",
    "Accessibility Enhancement Toolkit", "University KPI Analytics Dashboard"
  ];

  // POPULATE PROBLEMS & SYNC OCCUPANCY
  const renderProblems = () => {
    const list = document.getElementById('problemList');
    list.innerHTML = '';
    problems.forEach((title, index) => {
        const id = index + 1;
        const count = allProblemStats[id] || 0;
        const card = document.createElement('div');
        card.className = `problem-card ${count >= 2 ? 'full' : ''}`;
        card.innerHTML = `
            <div class="occupancy-badge" style="color: ${count >= 2 ? '#ff0033' : '#00e676'}">
                ${count}/2 Teams
            </div>
            <strong style="color: var(--st-blue)">#${id}</strong>
            <p style="margin: 10px 0 0 0; font-size: 0.85rem;">${title}</p>
        `;
        list.appendChild(card);
    });
  };

  // SYNC PROBLEM OCCUPANCY FROM DB
  onSnapshot(collection(db, "events", EVENT_ID, "registrations"), (snapshot) => {
      allProblemStats = {};
      snapshot.forEach(doc => {
          const topic = doc.data().submissions?.projectTopic;
          if(topic) allProblemStats[topic] = (allProblemStats[topic] || 0) + 1;
      });
      renderProblems();
  });

  // AUTH & LOGIN
  document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);

  onAuthStateChanged(auth, async (user) => {
      if(user) {
          const snap = await getDocs(collection(db, "events", EVENT_ID, "registrations"));
          let myTeam = null;
          snap.forEach(doc => {
              const members = doc.data().members || [];
              const found = members.some(m => (typeof m === 'string' ? m : m.email).toLowerCase() === user.email.toLowerCase());
              if(found && doc.data().verified) { myTeam = doc.data(); currentTeamId = doc.id; }
          });

          if(myTeam) {
              currentUser = user;
              document.getElementById('loginScreen').classList.add('hidden');
              document.getElementById('appContainer').classList.add('visible');
              document.getElementById('userName').textContent = user.displayName;
              document.getElementById('teamNameDisplay').textContent = myTeam.team_name.toUpperCase();
              if(user.photoURL) document.getElementById('userAvatar').style.backgroundImage = `url(${user.photoURL})`;
              loadDashboard(myTeam);
          } else {
              alert("Access Denied: Team not verified.");
              await signOut(auth);
          }
      }
  });

  function loadDashboard(team) {
      const subs = team.submissions || {};
      if(subs.projectTopic) {
          document.getElementById('projectTopic').value = subs.projectTopic;
          document.getElementById('projectTitle').value = subs.projectTitle;
          document.getElementById('projectTopic').disabled = true;
          document.getElementById('projectTitle').disabled = true;
          document.getElementById('freezeBtn').textContent = "LOCKED";
          document.getElementById('freezeBtn').disabled = true;
      }
      if(subs.round1Link) { document.getElementById('round1Link').value = subs.round1Link; disableBtn('btnRound1', "SENT"); }
      if(subs.finalGithub) { 
          document.getElementById('finalGithub').value = subs.finalGithub; 
          document.getElementById('finalPPT').value = subs.finalPPT;
          disableBtn('btnFinalRound', "SUBMITTED"); 
      }
  }

  function disableBtn(id, text) {
      const btn = document.getElementById(id);
      if(btn) { btn.textContent = text; btn.disabled = true; btn.style.borderColor="#00e676"; btn.style.color="#00e676"; }
  }

  // PROJECT FREEZE LOGIC WITH 2-TEAM LIMIT
  document.getElementById('freezeBtn').onclick = async () => {
      const id = parseInt(document.getElementById('projectTopic').value);
      const title = document.getElementById('projectTitle').value;
      
      if(!id || id < 1 || id > 50 || !title) return alert("Select a valid ID (1-50) and Title.");
      
      const count = allProblemStats[id] || 0;
      if(count >= 2) return alert("ERROR: Problem Statement at maximum capacity (2 teams already registered). Please select another.");

      if(confirm(`Lock Project #${id}: ${problems[id-1]}?`)) {
          await updateDoc(doc(db, "events", EVENT_ID, "registrations", currentTeamId), {
              "submissions.projectTopic": id,
              "submissions.projectTitle": title
          });
          location.reload();
      }
  };

  window.submitRound1 = async () => {
      const link = document.getElementById('round1Link').value;
      if(link) {
          await updateDoc(doc(db, "events", EVENT_ID, "registrations", currentTeamId), { "submissions.round1Link": link });
          disableBtn('btnRound1', "SENT");
      }
  };

  window.submitFinalRound = async () => {
      const git = document.getElementById('finalGithub').value;
      const ppt = document.getElementById('finalPPT').value;
      if(git && ppt) {
          await updateDoc(doc(db, "events", EVENT_ID, "registrations", currentTeamId), { 
              "submissions.finalGithub": git, "submissions.finalPPT": ppt 
          });
          disableBtn('btnFinalRound', "SUBMITTED");
      }
  };

  window.switchTab = (id) => {
      document.querySelectorAll('.show-section').forEach(el => { el.className = 'hidden-section'; });
      document.getElementById(id).className = 'show-section';
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
  };

  window.logout = () => signOut(auth).then(() => location.reload());

  // TIMER
  setInterval(() => {
    const now = new Date().getTime();
    let dist, label;
    if (now < DATE_START) { dist = DATE_START - now; label = "HACKATHON COMMENCES IN"; }
    else if (now < DATE_END) { dist = DATE_END - now; label = "HACKATHON ENDS IN"; document.getElementById('timer').style.color = "#00e676"; }
    else { document.getElementById("timer").innerHTML = "OFFLINE"; return; }

    const d = Math.floor(dist / 86400000);
    const h = Math.floor((dist % 86400000) / 3600000);
    const m = Math.floor((dist % 3600000) / 60000);
    const s = Math.floor((dist % 60000) / 1000);
    document.getElementById("timer").innerHTML = `${d}d ${h}h ${m}m ${s}s`;
    document.getElementById("timerLabel").innerHTML = label;
  }, 1000);

</script>
</body>
</html>
