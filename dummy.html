<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EDU HACK '26 | Supreme Console</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Rubik+Glitch&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  :root {
    --st-red: #ff0033;
    --st-green: #00e676;
    --st-blue: #00ccff;
    --st-orange: #ffab00;
    --bg-dark: #050505;
    --glass-surface: rgba(12, 12, 12, 0.98);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text-primary: #e0e0e0;
    --text-secondary: #86868b;
    --font-main: 'JetBrains Mono', monospace;
    --font-title: 'Rubik Glitch', cursive;
  }

  * { box-sizing: border-box; outline: none; }
  body {
    margin: 0; font-family: var(--font-main); background-color: var(--bg-dark);
    color: var(--text-primary); min-height: 100vh; overflow-x: hidden;
    background: radial-gradient(circle at 50% -20%, #1a0505 0%, #000 80%);
  }

  body::before {
    content: " "; display: block; position: fixed; top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
    background-size: 100% 4px; z-index: 1000; pointer-events: none;
  }

  /* AUTH OVERLAY */
  .login-screen {
    position: fixed; inset: 0; z-index: 2000; display: flex; flex-direction: column;
    align-items: center; justify-content: center; background: #000; transition: 0.8s ease;
  }
  .login-screen.hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }

  /* PERSISTENT ELEMENTS */
  .broadcast-header {
    background: var(--st-red); color: #fff; padding: 10px; font-size: 0.75rem;
    text-align: center; font-weight: bold; letter-spacing: 2px; position: sticky; top: 0; z-index: 1100;
  }

  .main-nav {
    background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(15px);
    border-bottom: 1px solid var(--glass-border); padding: 15px 5%;
    display: flex; justify-content: space-between; align-items: center; position: sticky; top: 38px; z-index: 1000;
  }

  /* TAB SYSTEM - FIXED LOGIC */
  .tab-container {
    max-width: 1000px; margin: 30px auto; display: flex; gap: 10px; padding: 5px;
    background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid var(--glass-border);
  }
  .tab-btn {
    flex: 1; padding: 14px; border: none; background: transparent; color: var(--text-secondary);
    font-family: var(--font-main); font-weight: bold; cursor: pointer; border-radius: 8px;
    text-transform: uppercase; font-size: 0.8rem; transition: 0.3s;
  }
  .tab-btn.active { background: #fff; color: #000; box-shadow: 0 0 15px rgba(255,255,255,0.3); }

  /* CONTENT WRAPPERS */
  .view-pane { max-width: 1100px; margin: 0 auto; padding: 0 20px 100px 20px; display: none; }
  .view-pane.active { display: block; animation: fadeIn 0.5s ease forwards; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .glass-card {
    background: var(--glass-surface); border: 1px solid var(--glass-border);
    padding: 30px; margin-bottom: 25px; position: relative; border-radius: 4px;
  }
  .glass-card::before { content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: var(--st-red); }

  /* PROBLEM GRID */
  .problem-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px; max-height: 500px; overflow-y: auto; padding-right: 10px;
  }
  .problem-item {
    background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border);
    padding: 20px; position: relative; transition: 0.3s;
  }
  .problem-item.full { border-color: var(--st-red); opacity: 0.4; }
  .count-tag { position: absolute; top: 12px; right: 12px; font-weight: bold; font-size: 0.7rem; }

  /* INPUTS & BTNS */
  input { background: #000; border: 1px solid #333; color: var(--st-green); padding: 14px; width: 100%; margin-bottom: 15px; }
  .btn-action {
    background: var(--st-red); color: #fff; border: none; padding: 15px 30px; font-weight: 800;
    cursor: pointer; width: 100%; clip-path: polygon(12px 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%, 0 12px);
  }
  .btn-action:disabled { background: #222; color: #555; cursor: not-allowed; clip-path: none; border: 1px solid #333; }

  .mentor-btn {
    position: fixed; bottom: 30px; right: 30px; background: var(--st-orange);
    width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    z-index: 1200; border: none; cursor: pointer; box-shadow: 0 0 20px rgba(255, 171, 0, 0.4);
  }
</style>
</head>
<body>

<div class="broadcast-header">BROADCAST: HACKATHON STAGE II IS LIVE | ALL SYSTEMS GREEN</div>

<div class="login-screen" id="loginScreen">
  <div class="glitch-logo" style="font-family: var(--font-title); font-size: 5rem; text-align: center;">EDU HACK<br>SUPREME</div>
  <button class="btn-action" id="loginBtn" style="width:auto; min-width:300px; background:#fff; color:#000;">INITIALIZE AUTH</button>
</div>

<header class="main-nav" id="mainHeader">
    <div>
        <h1 style="margin:0; font-size:1.5rem; letter-spacing:-1px;">EDUHACK<span style="color:var(--st-red)"> SUPREME</span></h1>
        <span style="font-size:0.7rem; color:var(--text-secondary);">COMMAND CONSOLE v2.6</span>
    </div>
    <div style="display:flex; align-items:center; gap:20px;">
        <div style="text-align:right;">
            <div id="userName" style="font-weight:bold; font-size:0.9rem;">RECRUIT</div>
            <div id="teamName" style="font-size:0.7rem; color:var(--st-green); font-weight:bold;">TEAM: ...</div>
        </div>
        <div id="userAvatar" style="width:42px; height:42px; border-radius:50%; background:#333; background-size:cover; border:1px solid #fff;"></div>
        <button onclick="logout()" style="background:transparent; border:1px solid var(--st-red); color:var(--st-red); padding:5px 10px; cursor:pointer; font-size:0.75rem;">LOGOUT</button>
    </div>
</header>

<div class="app-shell" id="appShell">
    <nav class="tab-container">
        <button class="tab-btn active" data-view="dash">Dashboard</button>
        <button class="tab-btn" data-view="matrix">Matrix</button>
        <button class="tab-btn" data-view="log">Mission Log</button>
    </nav>

    <div id="dash" class="view-pane active">
        <div style="text-align:center; margin-bottom:40px;">
            <div id="timer" style="font-family: var(--font-title); font-size: 5rem; text-shadow: 0 0 25px var(--st-red);">00h 00m 00s</div>
        </div>
        <div class="glass-card">
            <h3 style="color:var(--st-green); margin-top:0;">PROJECT CLAIM (CAPACITY 7)</h3>
            <div style="display:grid; grid-template-columns: 1fr 2fr auto; gap:15px;">
                <input type="number" id="topicId" placeholder="ID (1-15)">
                <input type="text" id="projTitle" placeholder="Project Title...">
                <button class="btn-action" id="lockBtn">SECURE ID</button>
            </div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:25px;">
            <div class="glass-card">
                <h3 style="color:var(--st-orange);">ROUND 1: PLANNING</h3>
                <input type="text" id="r1Link" placeholder="PPT Link">
                <button class="btn-action" id="r1Btn" onclick="submitR1()">SUBMIT R1</button>
            </div>
            <div class="glass-card">
                <h3 style="color:var(--st-blue);">FINAL: DEPLOYMENT</h3>
                <input type="text" id="gitLink" placeholder="GitHub Repo">
                <input type="text" id="finalPPT" placeholder="Final PPT">
                <button class="btn-action" id="finalBtn" onclick="submitFinal()">DEPLOY FINAL</button>
            </div>
        </div>
    </div>

    <div id="matrix" class="view-pane">
        <div class="glass-card">
            <h2 style="color:var(--st-blue); margin:0 0 20px 0;">PROBLEM STATEMENTS</h2>
            <div class="problem-grid" id="problemList"></div>
        </div>
    </div>

    <div id="log" class="view-pane">
        <div class="glass-card">
            <h2 style="color:var(--st-red); margin:0 0 20px 0;">MISSION TIMELINE</h2>
            <div id="logItems" style="line-height:2.2; font-size:0.95rem;"></div>
        </div>
    </div>
</div>

<button class="mentor-btn" onclick="callMentor()"><span class="material-icons">support_agent</span></button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, query, getDocs, doc, updateDoc, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBzEwEDcTDs2Y-NUAGZkhQJsFRg6MZxoYE",
    authDomain: "eduhack-432fd.firebaseapp.com",
    projectId: "eduhack-432fd",
    storageBucket: "eduhack-432fd.firebasestorage.app",
    messagingSenderId: "160252785408",
    appId: "1:160252785408:web:6a22e465982e3e510979e5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const EVENT_ID = "edu-hack-2025";

  let teamId = null;
  let stats = {};

  const problems = [
    {id:1, t:"Predictive Attendance Risk Analyzer", d:"Build a system analyzing patterns to flag students at risk and simulate automated intervention alerts."},
    {id:2, t:"Smart Academic Notification Engine", d:"Rule-based alert system for academic deadlines, fee reminders, and exam updates."},
    {id:3, t:"Intelligent Exam Seating Engine", d:"Automated seating optimizer maximizing hall utilization and minimizing malpractice probability."},
    {id:4, t:"Hostel Maintenance Priority System", d:"KAFKA-inspired workflow engine auto-prioritizing hostel complaints by severity and SLA."},
    {id:5, t:"Campus Emergency Broadcast Simulator", d:"Centralized platform pushing simulated alerts to multiple user roles in real time."},
    {id:6, t:"Unified Campus Resource Booking", d:"Booking system for labs and halls with clash detection and approval workflows."},
    {id:7, t:"Smart Bus Route Optimization Tool", d:"Transport analytics system optimizing routes using student demand patterns."},
    {id:8, t:"Student Feedback Sentiment Tool", d:"NLP-based dashboard converting raw feedback into academic and facility insights."},
    {id:9, t:"Hostel Utility Consumption Platform", d:"Monitoring system simulating water and power usage with anomaly detection."},
    {id:10, t:"Degree Progress Audit Automation", d:"System tracking course completion and credit requirements automatically."},
    {id:11, t:"Centralized Grievance Console", d:"Admin dashboard visualizing complaint categories and resolution performance."},
    {id:12, t:"Academic Performance Forecast", d:"Prediction model estimating semester outcomes and identifying support needs."},
    {id:13, t:"Campus Occupancy Heatmap", d:"Visualization tool simulating real-time classroom, library, and hostel trends."},
    {id:14, t:"Scholarship Eligibility Filter", d:"Rules-based system shortlisting candidates using academic/socioeconomic criteria."},
    {id:15, t:"University KPI Analytics Dashboard", d:"Executive dashboard combining academic, hostel, and grievance indicators."}
  ];

  const logData = [
    "JAN 30 5:00 PM: HACKATHON START", "5:00PM - 6:00PM: Event Launch",
    "6:00PM - 6:30PM: Problem Distribution", "6:30PM - 7:00PM: Project Planning",
    "7:00PM - 8:15PM: Dinner Break", "8:15PM - 9:00PM: Round 1 Submission",
    "10:00PM: Refreshment", "11:00PM - 3:00AM: Phase 1 Work",
    "JAN 31 3:00AM: Refreshment", "7:00AM - 9:00AM: Breakfast",
    "9:00AM - 10:00AM: Review", "10:00AM - 1:00PM: Phase 2 Work",
    "1:00PM - 2:00PM: Lunch Break", "2:00PM - 3:00PM: Final Touches",
    "3:30PM - 4:00PM: Final Submission", "5:00PM: Winners Announcement"
  ];

  const logContainer = document.getElementById('logItems');
  logData.forEach(l => logContainer.innerHTML += `<div><span style="color:var(--st-blue)">></span> ${l}</div>`);

  // FIX TAB SWITCHING
  document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.view-pane').forEach(v => v.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById(btn.dataset.view).classList.add('active');
      });
  });

  document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
  
  onAuthStateChanged(auth, async (user) => {
      if(user) {
          const snap = await getDocs(collection(db, "events", EVENT_ID, "registrations"));
          let myTeam = null;
          snap.forEach(d => {
              const members = d.data().members || [];
              const exists = members.some(m => (typeof m === 'string' ? m : m.email).toLowerCase() === user.email.toLowerCase());
              if(exists && d.data().verified) { myTeam = d.data(); teamId = d.id; }
          });

          if(myTeam) {
              document.getElementById('loginScreen').classList.add('hidden');
              document.getElementById('userName').textContent = user.displayName;
              document.getElementById('teamName').textContent = "TEAM: " + myTeam.team_name.toUpperCase();
              if(user.photoURL) document.getElementById('userAvatar').style.backgroundImage = `url(${user.photoURL})`;
              loadSubs(myTeam.submissions || {});
              syncStats();
          } else {
              alert("Access Denied."); signOut(auth);
          }
      }
  });

  function syncStats() {
      onSnapshot(collection(db, "events", EVENT_ID, "registrations"), (snap) => {
          stats = {};
          snap.forEach(d => {
              const topic = d.data().submissions?.projectTopic;
              if(topic) stats[topic] = (stats[topic] || 0) + 1;
          });
          renderMatrix();
      });
  }

  function renderMatrix() {
      const grid = document.getElementById('problemList');
      grid.innerHTML = "";
      problems.forEach(p => {
          const count = stats[p.id] || 0;
          const card = document.createElement('div');
          card.className = `problem-item ${count >= 7 ? 'full' : ''}`;
          card.innerHTML = `<span class="count-tag" style="color:${count >= 7 ? 'var(--st-red)' : 'var(--st-green)'}">${count}/7</span>
                            <strong style="color:var(--st-blue)">#${p.id} ${p.t}</strong><br>
                            <p style="font-size:0.75rem; color:#888; margin-top:10px; line-height:1.4;">${p.d}</p>`;
          grid.appendChild(card);
      });
  }

  function loadSubs(s) {
      if(s.projectTopic) {
          document.getElementById('topicId').value = s.projectTopic;
          document.getElementById('projTitle').value = s.projectTitle;
          ['topicId','projTitle','lockBtn'].forEach(id => document.getElementById(id).disabled = true);
          document.getElementById('lockBtn').textContent = "LOCKED";
      }
      if(s.round1Link) { document.getElementById('r1Link').value = s.round1Link; disableBtn('r1Btn'); }
      if(s.finalGithub) { 
          document.getElementById('gitLink').value = s.finalGithub; 
          document.getElementById('finalPPT').value = s.finalPPT; 
          disableBtn('finalBtn'); 
      }
  }

  document.getElementById('lockBtn').onclick = async () => {
      const id = parseInt(document.getElementById('topicId').value);
      const title = document.getElementById('projTitle').value;
      if(!id || !title || id < 1 || id > 15) return alert("Select ID 1-15.");
      if((stats[id] || 0) >= 7) return alert("Topic at 7-team capacity.");
      await updateDoc(doc(db, "events", EVENT_ID, "registrations", teamId), { "submissions.projectTopic": id, "submissions.projectTitle": title });
      location.reload();
  };

  window.submitR1 = async () => {
      const link = document.getElementById('r1Link').value;
      if(link) { await updateDoc(doc(db, "events", EVENT_ID, "registrations", teamId), { "submissions.round1Link": link }); location.reload(); }
  };

  window.submitFinal = async () => {
      const git = document.getElementById('gitLink').value;
      const ppt = document.getElementById('finalPPT').value;
      if(git && ppt) { await updateDoc(doc(db, "events", EVENT_ID, "registrations", teamId), { "submissions.finalGithub": git, "submissions.finalPPT": ppt }); location.reload(); }
  };

  window.logout = () => signOut(auth).then(() => location.reload());

  window.callMentor = async () => {
      const loc = prompt("Team Location?");
      if(loc) { await addDoc(collection(db, "mentor_requests"), { teamId, loc, time: serverTimestamp() }); alert("Signal sent."); }
  };

  function disableBtn(id) { document.getElementById(id).disabled = true; document.getElementById(id).textContent = "SUBMITTED"; }

  setInterval(() => {
    const end = new Date("Jan 31, 2026 17:00:00").getTime();
    const now = new Date().getTime();
    const dist = end - now;
    if (dist < 0) { document.getElementById('timer').textContent = "EXPIRED"; return; }
    const h = Math.floor(dist / 3600000);
    const m = Math.floor((dist % 3600000) / 60000);
    const s = Math.floor((dist % 60000) / 1000);
    document.getElementById('timer').textContent = `${h}h ${m}m ${s}s`;
  }, 1000);
</script>
</body>
</html>
