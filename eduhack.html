<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EDU HACK 24hrs Hackathon | 10X Club KARE</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />

<!-- QR Code -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  /* same design system from your API MAZE */
  :root{
    --glass: rgba(255,255,255,0.08);
    --glass-strong: rgba(255,255,255,0.15);
    --border: rgba(255,255,255,0.18);
    --white: #fff;
    --accent: #1657ff;
    --accent-2:#F2551D;
    --bg: #000;
    --radius: 24px;
  }
  *{ box-sizing: border-box; }
  body{
    margin:0;
    font-family: 'Montserrat', sans-serif;
    background: var(--bg);
    color: var(--white);
    min-height:100vh;
    background-image:
      radial-gradient(circle at 10% 20%, rgba(22,87,255,0.08) 0 60% , transparent 60%),
      radial-gradient(circle at 90% 80%, rgba(242,85,29,0.08) 0 60% , transparent 60%);
    background-attachment: fixed;
    overflow-x:hidden;
  }
  .container{ max-width:1100px; margin:0 auto; padding:24px 16px 120px; }
  .glass{
    background: var(--glass);
    border:1px solid var(--border);
    backdrop-filter: blur(18px) saturate(180%);
    -webkit-backdrop-filter: blur(18px) saturate(180%);
    border-radius: var(--radius);
    box-shadow: 0 24px 40px rgba(0,0,0,.3);
  }
  header.hero{ display:flex; gap:24px; align-items:center; padding:32px 28px; margin:24px 0 40px; flex-wrap:wrap; position:relative; overflow:hidden; }
  header.hero::after{ content:""; position:absolute; inset:0; background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.03) 50%, transparent 100%); transform:skewX(-20deg) translateX(-100%); animation:shine 5s infinite; }
  @keyframes shine{ 0%{ transform:skewX(-20deg) translateX(-120%);} 100%{transform:skewX(-20deg) translateX(120%);} }
  .logos{ display:flex; align-items:center; gap:16px; flex-wrap:wrap; }
  .logos img{ height:70px; object-fit:contain; background: rgba(255,255,255,0.04); border-radius:14px; padding:8px 12px; }
  .hero h1{ font-size:2.2rem; margin:0; }
  .tag{ display:inline-block; margin-top:8px; background:rgba(255,255,255,0.08); padding:6px 12px; border-radius:999px; font-size:0.9rem; letter-spacing:1px; }
  .grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(320px,1fr)); gap:28px; align-items:start; }
  .event-card{ padding:24px 22px; }
  .event-card h2{ margin:0 0 12px; }
  form#regForm{ padding:32px 26px; display:flex; flex-direction:column; gap:18px; }
  label{ font-size:.9rem; color:#e7e7e7; }
  input, select{ width:100%; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:12px; color:#fff; padding:12px 14px; outline:none; transition:border .25s; }
  input:focus, select:focus{ border-color: var(--accent); }
  .btn{ border:none; border-radius:999px; padding:14px 24px; font-weight:700; cursor:pointer; transition:all .25s; display:inline-flex; align-items:center; justify-content:center; gap:8px; }
  .btn-primary{ background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#fff; }
  .btn-primary:hover{ transform:translateY(-1px) scale(1.01); }
  .btn-ghost{ background: transparent; color: #fff; border: 1px solid rgba(255,255,255,0.15);}
  .price{ font-size:1.5rem; font-weight:700; }
  .team-list li{ background:rgba(255,255,255,0.05); padding:8px 12px; border-radius:8px; margin-top:6px; }
  .modal-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:2000; padding:20px; }
  .modal{ max-width:480px; width:100%; padding:24px; position:relative; }
  .close-x{ position:absolute; right:14px; top:12px; font-size:22px; cursor:pointer; opacity:.7; }
</style>
</head>
<body>
<div class="container">
  <header class="hero glass">
    <div class="logos">
      <img src="img/klu.png" alt="KARE">
      <img src="img/image 26.png" alt="10X Club KARE">
    </div>
    <div>
      <h1>EDU HACK – 24hrs Hackathon</h1>
      <div class="tag">11 OCT 2025 • KARE Campus</div>
    </div>
  </header>

  <div class="grid">
    <!-- Event Info -->
    
    <section class="event-card glass">
 
      <img src="img/edu hack.png" height="200px" width="200px" style="border-radius:12px;"/>
 
      <h2>Event Details</h2>
      <ul style="line-height:1.8;margin:0 0 18px 18px;">
        <li>24hr Hackathon – Build innovative apps & solutions for our university</li>
        <li>Team Size: 3 to 5 Members</li>
        <li>Per Person: ₹300 </li>
        <li>One person registers the team</li>
      </ul>
    </section>

    <!-- Registration -->
    <section class="glass">
      <form id="regForm">
        <h2>Register Your Team</h2>
        
        <div>
          <label for="teamName">Team Name</label>
          <input id="teamName" name="teamName" required />
        </div>

        <div>
          <label>Team Members (min 3, max 5)</label>
          <ul class="team-list" id="teamList"></ul>
          <button type="button" class="btn btn-ghost" id="addMemberBtn">+ Add Member</button>
        </div>

        <div>
          <label>Total Amount</label>
          <input id="totalAmount" value="₹ 0.00" disabled />
        </div>

        <div>
          <button type="button" class="btn btn-primary" id="payBtn">Proceed to Payment</button>
        </div>
      </form>
    </section>
  </div>
</div>

<!-- Add Member Modal -->
<div class="modal-overlay" id="memberOverlay">
  <div class="modal glass">
    <span class="close-x" id="closeMember">&times;</span>
    <h3>Add Team Member</h3>
    <div>
      <label>Name</label>
      <input id="memberName" required/>
    </div>
    <div>
      <label>Register No</label>
      <input id="memberRegno" required/>
    </div>
    <div>
        <label>Department</label>
        <select id="memberDept" name="dept" required>
              <option value="">Select</option>
              <option>IT</option>
              <option>CSE</option>
              <option>ECE</option>
              <option>EEE</option>
              <option>MECH</option>
              <option>CIVIL</option>
              <option>AIDS</option>
              <option>AIML</option>
              <option>Other</option>
            </select>
    </div>
    <div>
        <label>Year</label>
        <select id="memberYear" name="year" required>
              <option value="">Select</option>
              <option>1st Year</option>
              <option>2nd Year</option>
              <option>3rd Year</option>
              <option>4th Year</option>
            </select>
    </div>
    <div>
        <label>Email ID (only use klu id)</label>
        <input id="memberEmail" type="email" required/>
    </div>
    <br>
    <button class="btn btn-primary" id="saveMember">Add</button>
  </div>
</div>

<!-- PAYMENT MODAL (QR + Txn ID entry) -->
<div class="modal-overlay" id="paymentOverlay">
  <div class="modal glass" id="paymentCard">
    <span class="close-x" id="closePayment">&times;</span>
    <h3>Pay <span id="totalAmount"></span> via UPI</h3>
    <div class="divider"></div>

    <div class="qrpay-box">
  <img id="payQRImage" src="img/qr.jpeg" alt="Scan to Pay" width="200" height="200" style="border-radius:12px;" />
  <div style="opacity:.8; font-size:.9rem;" id="upiText"></div>
</div>

    <form id="paymentForm" style="display:flex; flex-direction:column; gap:14px;">
      <div>
        <label for="txnId">Transaction / UTR ID (required)</label>
        <input id="txnId" name="txnId" required placeholder="e.g., 3245XXXXXXXX" />
      </div>
      <div>
        <label for="payerName">Payer Name (as shown in app)</label>
        <input id="payerName" name="payerName" placeholder="Optional" />
      </div>
      <div>
        <label for="paidAmount">Amount Paid</label>
        <input id="paidAmount" name="paidAmount" type="number" value="100" disabled/>
      </div>

      <button type="submit" class="btn btn-primary" id="completePaymentBtn">
        <span class="btn-text" disabled>Complete Payment</span>
        <span class="btn-spinner"></span>
      </button>
    </form>
  </div>
</div>

<!-- SUCCESS POPUP -->
<div class="modal-overlay" id="successOverlay">
  <div class="modal glass">
    <span class="close-x" id="closeSuccess">&times;</span>
    <h3>Payment Submitted</h3>
    <div class="divider"></div>
    <p style="text-align:center; line-height:1.6;">
      Thank you! You will get your entry pass in your profile at 10xclubkare.vercel.app.
    </p>
    <div style="display:flex; justify-content:center; margin-top:12px;">
      <button class="btn btn-primary" id="okSuccess">OK</button>
    </div>
  </div>
</div>
<footer>
  <center><p>&copy; 2025 10X Club KARE. All rights reserved.</p></center>
</footer>

<script type="module">
/* ---------- Firebase ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, collection, doc, setDoc, getDocs, query, where, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = { 
  apiKey: "AIzaSyBzEwEDcTDs2Y-NUAGZkhQJsFRg6MZxoYE",
  authDomain: "eduhack-432fd.firebaseapp.com",
  projectId: "eduhack-432fd",
  storageBucket: "eduhack-432fd.firebasestorage.app",
  messagingSenderId: "160252785408",
  appId: "1:160252785408:web:6a22e465982e3e510979e5",
  measurementId: "G-WCKZ62NM6N"
};
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* ---------- Constants ---------- */
const EVENT_ID   = "edu-hack-2025";
const MEMBER_FEE = 300;
const UPI_ID     = "sundaradhira-1@okicici";
const UPI_NAME   = "Sundarrajan R";

/* ---------- Elements ---------- */
const addMemberBtn   = document.getElementById('addMemberBtn');
const memberOverlay  = document.getElementById('memberOverlay');
const closeMember    = document.getElementById('closeMember');
const saveMember     = document.getElementById('saveMember');
const memberName     = document.getElementById('memberName');
const memberRegno    = document.getElementById('memberRegno');
const memberDept     = document.getElementById('memberDept');
const memberYear     = document.getElementById('memberYear');
const memberEmail    = document.getElementById('memberEmail');
const teamNameInput  = document.getElementById('teamName');   // Team Name input
const teamList       = document.getElementById('teamList');
const totalAmount    = document.getElementById('totalAmount');
const payBtn         = document.getElementById('payBtn');

const paymentOverlay     = document.getElementById('paymentOverlay');
const closePayment       = document.getElementById('closePayment');
const paymentForm        = document.getElementById('paymentForm');
const txnIdInput         = document.getElementById('txnId');
const payerNameInput     = document.getElementById('payerName');
const paidAmountInput    = document.getElementById('paidAmount');
const completePaymentBtn = document.getElementById('completePaymentBtn');
const completeBtnText    = completePaymentBtn?.querySelector('.btn-text');
const completeBtnSpin    = completePaymentBtn?.querySelector('.btn-spinner');

const successOverlay = document.getElementById('successOverlay');
const closeSuccess   = document.getElementById('closeSuccess');
const okSuccess      = document.getElementById('okSuccess');
const upiTextEl      = document.getElementById('upiText');

let members = [];
let submitting = false;

/* ---------- Add Member ---------- */
addMemberBtn.onclick = ()=> memberOverlay.style.display="flex";
closeMember.onclick  = ()=> memberOverlay.style.display="none";

saveMember.onclick = ()=>{
  const name  = memberName.value.trim();
  const reg   = memberRegno.value.trim();
  const dept  = memberDept.value.trim();
  const year  = memberYear.value.trim();
  const email = memberEmail.value.trim();

  if(!name || !reg || !dept || !year || !email){ alert("Fill all fields"); return; }
  if(members.length>=5){ alert("Max 5 members only"); return; }

  members.push({name, reg, dept, year, email});
  renderMembers();

  memberName.value = "";
  memberRegno.value = "";
  memberDept.value = "";
  memberYear.value = "";
  memberEmail.value = "";
  memberOverlay.style.display="none";
};

function renderMembers(){
  teamList.innerHTML = "";
  members.forEach((m,i)=>{
    const li=document.createElement("li");
    li.textContent = `${i+1}. ${m.name} (${m.reg}) - ${m.dept}, ${m.year} - ${m.email}`;
    teamList.appendChild(li);
  });
  totalAmount.value = `₹ ${members.length*MEMBER_FEE}.00`;
}

/* ---------- Show Payment Modal ---------- */
payBtn.onclick = ()=>{
  if(members.length<3){ alert("Add at least 3 members"); return; }
  if(!teamNameInput.value.trim()){ alert("Enter Team Name"); return; }

  const amount = members.length*MEMBER_FEE;
  paidAmountInput.value = amount;
  upiTextEl.textContent = `${UPI_ID} • ${UPI_NAME}`;
  paymentOverlay.style.display="flex";
};

closePayment.onclick = ()=> paymentOverlay.style.display="none";
paymentOverlay.addEventListener('click', (e)=>{ if(e.target===paymentOverlay) paymentOverlay.style.display="none"; });

closeSuccess.onclick = ()=> successOverlay.style.display="none";
okSuccess.onclick    = ()=> successOverlay.style.display="none";
successOverlay.addEventListener('click', (e)=>{ if(e.target===successOverlay) successOverlay.style.display="none"; });

/* ---------- Helpers ---------- */
function setCompleteBtnLoading(state){
  if(state){
    completePaymentBtn.disabled = true;
    completeBtnSpin.style.display = 'inline-block';
    completeBtnText.textContent = 'Processing...';
  }else{
    completePaymentBtn.disabled = false;
    completeBtnSpin.style.display = 'none';
    completeBtnText.textContent = 'Complete Payment';
  }
}
function generateToken(teamName){
  const suffix = Math.floor(Math.random()*900+100);
  return `EDH-${teamName}-${suffix}`;
}
async function isDuplicateTxn(txnId){
  const q=query(collection(db,"events",EVENT_ID,"registrations"), where("transaction_id","==",txnId));
  const snap=await getDocs(q);
  return !snap.empty;
}

/* ---------- Payment Submit ---------- */
paymentForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(submitting) return;
  submitting=true;
  setCompleteBtnLoading(true);

  const txnId   = txnIdInput.value.trim();
  const payer   = payerNameInput.value.trim();
  const amount  = Number(paidAmountInput.value);
  const teamName = teamNameInput.value.trim();

  if(!txnId){ alert("Enter Transaction / UTR ID"); setCompleteBtnLoading(false); submitting=false; return; }

  // ✅ Duplicate check
  if(await isDuplicateTxn(txnId)){ 
    alert("⚠️ This Transaction ID is already registered!"); 
    setCompleteBtnLoading(false); 
    submitting=false; 
    return; 
  }

  try{
    const tokenId = generateToken(teamName);
    const paidAt  = new Date().toISOString();

    await savePaymentToFirestore({
      event: EVENT_ID,
      team_name: teamName,
      members,
      total_members: members.length,
      amount,
      status: "submitted",
      paid_at: paidAt,
      token: tokenId,
      transaction_id: txnId,
      payer_name: payer || null,
      upi_id: UPI_ID,
      verified: false
    });

    paymentOverlay.style.display="none";
    successOverlay.style.display="flex";
    members=[];
    renderMembers();
    teamNameInput.value="";
  }catch(err){
    console.error("Firestore error:", err);
    alert("Something went wrong. Please try again.");
  }finally{
    submitting=false;
    setCompleteBtnLoading(false);
  }
});

/* ---------- Firestore ---------- */
async function savePaymentToFirestore(data){
  const colRef = collection(db, "events", EVENT_ID, "registrations");
  const ref    = doc(colRef);
  await setDoc(ref, {
    ...data,
    id: ref.id,
    createdAt: serverTimestamp()
  }, { merge:true });
}
</script>
</body>
</html>
